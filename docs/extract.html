---

title: Data Extraction and Cleaning


keywords: fastai
sidebar: home_sidebar

summary: "The TMDB dataset is only accessible through an API. Hence, we will write a few functions to extract the dataset, perform some simple preprocessing before saving to csv files."
description: "The TMDB dataset is only accessible through an API. Hence, we will write a few functions to extract the dataset, perform some simple preprocessing before saving to csv files."
nb_path: "01_extract.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_extract.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We first extract the dataset by accessing the TMDB API. Since not all requests will be successful, a larger than desired dataset size value should be used to return an eventual dataset size of roughly the same magnitude.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_dataset_threaded" class="doc_header"><code>extract_dataset_threaded</code><a href="https://github.com/Benjamintdk/DSAI_proj/tree/main/DSAI_proj/extract.py#L24" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_dataset_threaded</code>(<strong><code>api_key</code></strong>:<code>str</code>, <strong><code>max_ds_size</code></strong>:<code>int</code>, <strong><code>max_threads</code></strong>:<code>int</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's run the data extraction functions.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">max_ds_size</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">max_threads</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">extract_dataset_threaded</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
                                  <span class="n">max_ds_size</span><span class="o">=</span><span class="n">max_ds_size</span><span class="p">,</span>
                                  <span class="n">max_threads</span><span class="o">=</span><span class="n">max_threads</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of examples downloaded is: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">movies</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">movies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Total number of examples downloaded is: 15
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>adult</th>
      <th>backdrop_path</th>
      <th>belongs_to_collection</th>
      <th>budget</th>
      <th>genres</th>
      <th>...</th>
      <th>tagline</th>
      <th>title</th>
      <th>video</th>
      <th>vote_average</th>
      <th>vote_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>False</td>
      <td>/hQ4pYsIbP22TMXOUdSfC2mjWrO0.jpg</td>
      <td>None</td>
      <td>0</td>
      <td>[{'id': 18, 'name': 'Drama'}, {'id': 80, 'name...</td>
      <td>...</td>
      <td></td>
      <td>Ariel</td>
      <td>False</td>
      <td>6.8</td>
      <td>128</td>
    </tr>
    <tr>
      <th>1</th>
      <td>False</td>
      <td>/l94l89eMmFKh7na2a1u5q67VgNx.jpg</td>
      <td>None</td>
      <td>0</td>
      <td>[{'id': 18, 'name': 'Drama'}, {'id': 35, 'name...</td>
      <td>...</td>
      <td></td>
      <td>Shadows in Paradise</td>
      <td>False</td>
      <td>7.2</td>
      <td>126</td>
    </tr>
    <tr>
      <th>2</th>
      <td>False</td>
      <td>/u0zMKKpEdDWpOKmFW2sLbKKICJH.jpg</td>
      <td>None</td>
      <td>4000000</td>
      <td>[{'id': 80, 'name': 'Crime'}, {'id': 35, 'name...</td>
      <td>...</td>
      <td>Twelve outrageous guests. Four scandalous requ...</td>
      <td>Four Rooms</td>
      <td>False</td>
      <td>5.7</td>
      <td>1910</td>
    </tr>
    <tr>
      <th>3</th>
      <td>False</td>
      <td>/5aXp2s4l6g5PcMMesIj63mx8hmJ.jpg</td>
      <td>None</td>
      <td>21000000</td>
      <td>[{'id': 28, 'name': 'Action'}, {'id': 53, 'nam...</td>
      <td>...</td>
      <td>Don't move. Don't whisper. Don't even breathe.</td>
      <td>Judgment Night</td>
      <td>False</td>
      <td>6.5</td>
      <td>184</td>
    </tr>
    <tr>
      <th>4</th>
      <td>False</td>
      <td>None</td>
      <td>None</td>
      <td>42000</td>
      <td>[{'id': 99, 'name': 'Documentary'}]</td>
      <td>...</td>
      <td>A Megacities remix.</td>
      <td>Life in Loops (A Megacities RMX)</td>
      <td>False</td>
      <td>7.4</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 25 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Looking at the first 5 rows of the scraped dataset, we easily see that some example taglines (under the tagline column) are missing. We'll need to separate these examples into a separate csv file as they do not have labels. Additionally, we can create our train, validation and test datasets concurrently and save them into separate csv files. This helps reproducibility later on. We also print the relative proportions of each dataset to see if we will need to redo the extraction process above.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_splits" class="doc_header"><code>create_splits</code><a href="https://github.com/Benjamintdk/DSAI_proj/tree/main/DSAI_proj/extract.py#L35" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_splits</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>label</code></strong>:<code>str</code>, <strong><code>splits</code></strong>:<code>list</code>, <strong><code>seed</code></strong>:<code>int</code>, <strong><code>keep_missing</code></strong>:<code>bool</code>, <strong><code>save_path</code></strong>:<code>str</code>=<em><code>'.'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">splits</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;tagline&quot;</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">create_splits</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">movies</span><span class="p">,</span>
              <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
              <span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span>
              <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
              <span class="n">keep_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

